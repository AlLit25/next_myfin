(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[507],{433:()=>{},3060:(e,t,a)=>{Promise.resolve().then(a.bind(a,3688))},3688:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>B});var s=a(5155),r=a(8148),n=a(4964),l=a(2115),c=a(2253),i=a(4091),d=a(9582),o=a(5576);function u(e){let t=0;return e.map(e=>{t+=e.sum}),t}function h(e){return e.reduce((e,t)=>{let a=t.created_at,s=t.category,r=t.sum;return e[a]||(e[a]={}),e[a][s]=(e[a][s]||0)+r,e},{})}function m(e){let t={};return Object.keys(e).map(a=>{Object.keys(e[a]).map(s=>{void 0===t[s]?t[s]=Number(e[a][s]):t[s]+=Number(e[a][s])})}),t}function x(e,t){let a=[];return Object.keys(t).map(s=>{a.push({name:o.L[s],value:t[s],percentage:(t[s]/e*100).toFixed(1)})}),a}function j(e){let{data:t}=e;if(!(t.length>0))return(0,s.jsx)("div",{className:"alert alert-info",role:"alert",children:"Дані відсутні"});{let e=u(t);return(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"alert alert-success",role:"alert",children:["Дохід ",(0,s.jsx)("i",{children:e})," UAH"]}),(0,s.jsxs)("table",{className:"table table-striped",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"Сума"}),(0,s.jsx)("th",{children:"Дата"})]})}),(0,s.jsx)("tbody",{children:t.map(e=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:e.sum}),(0,s.jsx)("td",{children:new Date(e.created_at).toLocaleDateString("uk-UA")})]},e.id))})]})]})}}var f=a(134),p=a(1259),v=a(9386),N=a(3420),b=a(46);function g(e){let{active:t,payload:a}=e;if(t&&a&&a.length){let{name:e,value:t,percentage:r}=a[0].payload;return(0,s.jsx)("div",{className:"bg-white p-2 border border-gray-300 rounded shadow",children:(0,s.jsx)("p",{children:"".concat(e,": ").concat(t," (").concat(r,"%)")})})}return null}function y(e){let{data:t}=e,a=["#0088FE","#00C49F","#FFBB28","#0257a5","#41c400","#ff7a28","#9800fe","#c4004b","#ff2828","#00fec3","#a0c400","#35189c"];return(0,s.jsx)("div",{className:"flex justify-center",children:(0,s.jsxs)(f.r,{width:600,height:400,children:[(0,s.jsx)(p.F,{data:t,cx:"50%",cy:"50%",outerRadius:150,fill:"#8884d8",dataKey:"value",label:e=>{let{name:t,percentage:a}=e;return"".concat(t,": ").concat(a,"%")},children:t.map((e,t)=>(0,s.jsx)(v.f,{fill:a[t%a.length]},"cell-".concat(t)))}),(0,s.jsx)(N.m,{content:(0,s.jsx)(g,{})}),(0,s.jsx)(b.s,{})]})})}function w(e){let{data:t}=e;if(!(t.length>0))return(0,s.jsx)("div",{className:"alert alert-info",role:"alert",children:"Дані відсутні"});{let e=h(t),a=u(t),r=Object.keys(e).sort((e,t)=>new Date(e)-new Date(t)),n=x(a,m(e));return(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"alert alert-danger",role:"alert",children:["Витрати ",(0,s.jsx)("i",{children:a})," UAH"]}),(0,s.jsx)("div",{className:"d-flex justify-content-center",children:(0,s.jsx)(y,{data:n})}),(0,s.jsxs)("table",{className:"table table-striped",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"Категорія"}),(0,s.jsx)("th",{children:"Сума"})]})}),(0,s.jsx)("tbody",{children:(0,s.jsx)(k,{data:r,sortData:e})})]})]})}}function k(e){let{data:t,sortData:a}=e;return t&&"object"==typeof t?(0,s.jsx)(s.Fragment,{children:t.map(e=>(0,s.jsxs)(l.Fragment,{children:[(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:"3",children:(0,s.jsx)("b",{children:new Date(e).toLocaleDateString("uk-UA")})})}),Object.entries(o.L).map(t=>{let[r]=t;return void 0!==a[e][r]?(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:o.L[r]}),(0,s.jsx)("td",{children:a[e][r]})]},r):""})]},e))}):null}function D(e){let{isOpen:t,onClose:a,title:r,children:n}=e,c=(0,l.useRef)(null),[i,d]=(0,l.useState)(!1),[o,u]=(0,l.useState)(!1);return((0,l.useEffect)(()=>{if(t){let e=setTimeout(()=>{d(!0)},50);return()=>clearTimeout(e)}d(!1)},[t]),(0,l.useEffect)(()=>{if(!i&&t){let e=setTimeout(()=>{a()},500);return()=>clearTimeout(e)}},[i,t,a]),t)?(0,s.jsx)("div",{className:"custom-modal-overlay ".concat(i?"show":""),children:(0,s.jsxs)("div",{className:"custom-modal",ref:c,children:[r&&(0,s.jsxs)("div",{className:"custom-modal-header",children:[(0,s.jsxs)("h5",{className:"",children:[r," ",(0,s.jsx)("img",{src:"/icons/edit.svg",alt:"Редагувати",width:"24",height:"24",className:"edit-btn",onClick:function(){let e=!o;console.log(e),u(e)},style:{marginLeft:"8px",verticalAlign:"middle"}})]}),(0,s.jsx)("button",{className:"custom-modal-close-btn",onClick:()=>d(!1),"aria-label":"Close",children:(0,s.jsx)("svg",{width:"24",height:"24",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),(0,s.jsx)("div",{className:"custom-modal-body",children:n}),(0,s.jsx)("div",{className:"custom-modal-footer",children:(0,s.jsx)("button",{className:"btn btn-success fade ".concat(o?"show":""),children:"Зберегти"})})]})}):null}function S(e){let{data:t,dateStart:a,dateEnd:r}=e,n=h(t),c=u(t),i=function(e,t){let a=[],s=new Date(e),r=new Date(t);for(;s<=r;)a.push(s.toISOString().split("T")[0]),s.setDate(s.getDate()+1);return a}(a,r),d=x(c,m(n)),[j,f]=(0,l.useState)(!1),[p,v]=(0,l.useState)(null),[N,b]=(0,l.useState)({}),g=e=>{let a=function(e,t){let a=[];return e.map(e=>{e.created_at===t&&a.push(e)}),a}(t,e);v(e),b(a||[]),f(!0)};return(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"alert alert-danger",role:"alert",children:["Витрати ",(0,s.jsx)("i",{children:c})," UAH"]}),(0,s.jsxs)("div",{className:"d-flex mt-5",children:[(0,s.jsx)(O,{}),(0,s.jsx)("div",{className:"d-flex scrollable-table",children:i.map(e=>(0,s.jsx)(_,{date:e,items:n[e]||{},openDetail:g},e))})]}),(0,s.jsx)("div",{className:"d-flex justify-content-center",children:(0,s.jsx)(y,{data:d})}),(0,s.jsx)(D,{isOpen:j,onClose:()=>f(!1),title:"Деталі витрат за ".concat(p?new Date(p).toLocaleDateString("uk-UA"):""),children:p&&N.length>0?(0,s.jsx)("ul",{children:N.map(e=>(0,s.jsxs)("li",{children:[e.sum," UAH - ",o.L[e.category],e.comment?(0,s.jsx)("span",{children:" ("+e.comment+")"}):"",(0,s.jsx)("img",{src:"/icons/delete.svg",alt:"Видалити",width:"24",height:"24",className:"delete-btn",style:{marginLeft:"8px",verticalAlign:"middle"}})]},e.id))}):(0,s.jsx)("p",{children:"Немає витрат за цей день."})})]})}function _(e){let{date:t,items:a,openDetail:r}=e,n=0;return(0,s.jsxs)("div",{className:"colum-expense",children:[(0,s.jsx)("div",{className:"m-1 colum-date",onClick:()=>r(t),children:new Date(t).toLocaleDateString("uk-UA")}),(0,s.jsx)("div",{children:Object.entries(o.L).map(e=>{let[l]=e,c=a[l]?Number(a[l]):0,i="v-normal";return c>0&&(n+=c),0===c?i="v-gold":c>4e3&&(i="v-many"),(0,s.jsx)("div",{className:i+" v-border",children:c?(0,s.jsx)("span",{className:"value",onClick:()=>r(t),children:c}):(0,s.jsx)("span",{className:"zero-value"})},l)})}),(0,s.jsx)("div",{className:"",children:n?(0,s.jsx)("span",{className:"value",children:(0,s.jsx)("b",{children:n})}):(0,s.jsx)("span",{className:"zero-value"})})]})}function O(){return(0,s.jsxs)("div",{className:"category-column",children:[(0,s.jsx)("div",{className:"m-1",children:"Категорія/Дата"}),Object.entries(o.L).map(e=>{let[t,a]=e;return(0,s.jsx)("div",{className:"v-light v-border",children:a},t)}),(0,s.jsx)("div",{className:"",children:"За день"})]})}function B(){let[e,t]=(0,l.useState)({income:[],expense:[]}),[a,o]=(0,l.useState)(!0),[u,h]=(0,l.useState)(null),[m,x]=(0,l.useState)(c.Fr?(0,d._)():(0,d.E)()),f=async(e,a)=>{try{o(!0),h(null);let s=await (0,n.h5)(e,a);if(s.error)h(s.error),t({income:[],expense:[]});else{let e={income:[],expense:[]};(s.data||[]).forEach(t=>{"expense"===t.type?e.expense.push(t):"income"===t.type&&e.income.push(t)}),t(e)}o(!1)}catch(e){h("Помилка завантаження даних"),t({income:[],expense:[]}),o(!1),(0,n.e4)(),location.replace("/")}};return(0,l.useEffect)(()=>{f(m.from,m.to)},[]),(0,s.jsxs)("div",{className:"container mt-5",children:[(0,s.jsx)("div",{className:"text-center",children:(0,s.jsx)("h1",{children:"Статистика"})}),(0,s.jsx)("div",{className:"d-block mb-3",children:(0,s.jsx)(r.A,{href:"/",color:"secondary",text:"На головну"})}),(0,s.jsxs)("div",{className:"row mt-3 mb-3",children:[(0,s.jsx)("div",{className:"col-4",children:(0,s.jsx)("input",{type:"date",className:"form-control",value:m.from,"data-date-from":"",onChange:e=>x({...m,from:e.target.value})})}),(0,s.jsx)("div",{className:"col-4",children:(0,s.jsx)("input",{type:"date",className:"form-control","data-date-to":"",value:m.to,onChange:e=>x({...m,to:e.target.value})})}),(0,s.jsx)("div",{className:"col-4",children:(0,s.jsx)("button",{type:"button",className:"btn btn-success",onClick:()=>{let e=document.querySelector("input[data-date-from]").value,t=document.querySelector("input[data-date-to]").value;e&&t?(x({from:e,to:t}),f(e,t)):h("Будь ласка, виберіть обидві дати")},children:"Відобразити"})})]}),(0,s.jsx)("div",{children:u?(0,s.jsx)("div",{className:"alert alert-danger",role:"alert",children:u}):a?(0,s.jsx)(i.A,{header:!1}):(0,s.jsxs)("div",{children:[(0,s.jsx)(j,{data:e.income}),c.Fr?(0,s.jsx)(w,{data:e.expense}):(0,s.jsx)(S,{data:e.expense,dateStart:m.from,dateEnd:m.to})]})})]})}a(433)},4091:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});var s=a(5155);function r(e){let{header:t=!0}=e;return(0,s.jsxs)("div",{className:"container",children:[t?(0,s.jsx)("div",{className:"m-5 text-center",children:(0,s.jsx)("p",{className:"h1",children:"LiVi Analytics"})}):"",(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"spinner-border text-success",role:"status",children:(0,s.jsx)("span",{className:"visually-hidden"})}),(0,s.jsx)("h3",{children:"Завантаження..."})]})]})}},4964:(e,t,a)=>{"use strict";a.d(t,{Ou:()=>o,T5:()=>l,e4:()=>i,h5:()=>d,r1:()=>m,uo:()=>h});var s=a(2378),r=a(5576);function n(){let e=s.A.get("supabase-auth-token");return e||null}async function l(){try{let t,a=n();try{(t=JSON.parse(a)).access_token&&t.refresh_token||c()}catch(e){c()}let{data:{session:l},error:i}=await r.DB.auth.setSession({access_token:t.access_token,refresh_token:t.refresh_token});if(!i)return l;{var e;let{data:a,error:n}=await r.DB.auth.refreshSession({refresh_token:t.refresh_token});return n?c():(e=l,s.A.set("supabase-auth-token",JSON.stringify(e),{expires:1,path:"/",secure:!0,sameSite:"Strict"})),a.session}}catch(e){console.error("Помилка перевірки автентифікації:",e.message,e.line),c()}}function c(){"/"!==location.pathname&&(location.href="/")}function i(){s.A.remove("supabase-auth-token",{path:"/"})}async function d(e,t){let a={data:null,error:""};try{if(!await l())return a.error="Користувач не авторизований",a;let{data:s,error:n}=await r.DB.from(r.B.main).select("*").gte("created_at",e).lte("created_at",t);if(n)return a.error="Помилка отримання даних із ".concat(r.B.main,": ")+n.message,a;a.data=s}catch(e){a.error="Виняток у getStatistic: "+e.message}return a}async function o(e,t,a,s,c){try{if(!await l())throw"Користувач не авторизований";let i=JSON.parse(n()),d={sum:t,type:a,user_id:i.user.id,created_at:new Date(e),category:s||null,comment:c||null},{error:o}=await r.DB.from(r.B.main).insert([d]);if(o)throw o;return await u(t,a),!0}catch(e){return console.error("Помилка запиту:",e.message),!1}}async function u(e,t){let a=await m(),s=0;a.data.id>0&&(s="expense"===t?a.data.uah-Number(e):a.data.uah+Number(e),await h(a.data.id,s))}async function h(e,t){try{if(!await l())throw"Користувач не авторизований";let a=JSON.parse(n()),s={uah:t,user_id:a.user.id,last_check:new Date},{error:c}=await r.DB.from(r.B.balance).update(s).eq("id",e);if(c)throw c;return!0}catch(e){return console.error("Помилка запиту:",e.message),!1}}async function m(){let e={data:null,error:""};try{if(!await l())return e.error="Користувач не авторизований",e;let t=JSON.parse(n()),{data:a,error:s}=await r.DB.from(r.B.balance).select("*").eq("user_id",t.user.id).single();if(s)return e.error="Помилка отримання даних із ".concat(r.B.balance,": ")+s.message,e;e.data=a}catch(t){e.error="Виняток у getBalance: "+t.message}return e}},5576:(e,t,a)=>{"use strict";a.d(t,{B:()=>r,DB:()=>s,L:()=>n});let s=(0,a(2659).UU)("https://vntunuzrneoakdckqjvk.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZudHVudXpybmVvYWtkY2txanZrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE3MTI5NzEsImV4cCI6MjA2NzI4ODk3MX0.CWJIVqq-x5_doDk8rsl8ZJWP7um9VakuIDBihcfsrsU"),r={main:"fin_statistic",balance:"fin_balance"},n={pr:"Продукти",cf:"Кафе",cm:"Кумунальні платежі",md:"Аптека",eva:"Eva/Makeup",zoo:"Зоотовари",cl:"Одяг",usd:"Валюта",ot:"Інше"}},8148:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var s=a(5155),r=a(2619),n=a.n(r);function l(e){let{href:t,text:a,color:r}=e;return(0,s.jsx)("div",{className:"text-center p-2",children:(0,s.jsx)(n(),{href:t,className:"btn btn-".concat(r," btn-menu fs-4 fw-bold"),children:a})})}},9582:(e,t,a)=>{"use strict";function s(){let e=new Date,t=new Date(e);return t.setDate(e.getDate()+1),{from:n(e),to:n(t)}}function r(){let e=new Date,t=new Date(e.getFullYear(),e.getMonth(),1),a=new Date(e.getFullYear(),e.getMonth()+1,0);return{from:n(t),to:n(a)}}function n(e){let t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(a,"-").concat(s)}a.d(t,{E:()=>r,_:()=>s})}},e=>{e.O(0,[594,779,443,441,255,358],()=>e(e.s=3060)),_N_E=e.O()}]);