(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[507],{433:()=>{},907:(e,t,r)=>{"use strict";r.d(t,{E6:()=>i,PD:()=>u,ac:()=>c,b8:()=>o,cI:()=>d,nS:()=>l,w8:()=>n,zl:()=>s});var a=r(5576);function n(e){let t=0;return e.map(e=>{t+=e.sum}),t}function s(e){return e.reduce((e,t)=>{let r=t.created_at,a=t.category,n=t.sum;return e[r]||(e[r]={}),e[r][a]=(e[r][a]||0)+n,e},{})}function l(e){let t={};return Object.keys(e).map(r=>{Object.keys(e[r]).map(a=>{void 0===t[a]?t[a]=Number(e[r][a]):t[a]+=Number(e[r][a])})}),t}function c(e,t){let r=[],a=new Date(e),n=new Date(t);for(;a<=n;)r.push(a.toISOString().split("T")[0]),a.setDate(a.getDate()+1);return r}function i(e,t){let r=[];return Object.keys(t).map(n=>{r.push({name:a.L1[n],value:t[n],percentage:(t[n]/e*100).toFixed(1)})}),r}function o(e){return Object.keys(e).sort((e,t)=>new Date(e)-new Date(t))}function d(e,t){let r=[];return e.map(e=>{e.created_at===t&&r.push(e)}),r}function u(){let e=document.querySelector('button[data-refresh="statistic"]');void 0!==e&&e.click()}},3060:(e,t,r)=>{Promise.resolve().then(r.bind(r,9270))},4091:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var a=r(5155);function n(e){let{header:t=!0}=e;return(0,a.jsxs)("div",{className:"container",children:[t?(0,a.jsx)("div",{className:"m-5 text-center",children:(0,a.jsx)("p",{className:"h1",children:"LiVi Analytics"})}):"",(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"spinner-border text-success",role:"status",children:(0,a.jsx)("span",{className:"visually-hidden"})}),(0,a.jsx)("h3",{children:"Завантаження..."})]})]})}},4964:(e,t,r)=>{"use strict";r.d(t,{Ou:()=>d,T5:()=>l,Wv:()=>x,e4:()=>i,h5:()=>o,m8:()=>u,pt:()=>c,r1:()=>f,uo:()=>h});var a=r(2378),n=r(5576);function s(){let e=a.A.get("supabase-auth-token");return e||null}async function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{let r,l=s();try{if(null===l||(r=JSON.parse(l),null===r))return null;{if(!r.access_token||!r.refresh_token)return await goToLogin(e),null;let{data:{session:s},error:l}=await n.DB.auth.setSession({access_token:r.access_token,refresh_token:r.refresh_token});if(!l)return s;{var t;let{data:e,error:s}=await n.DB.auth.refreshSession({refresh_token:r.refresh_token});if(s)return null;return t=e.session,a.A.set("supabase-auth-token",JSON.stringify(t),{expires:1,path:"/",secure:!0,sameSite:"Strict"}),e.session}}}catch(e){return null}}catch(e){return console.error("Помилка перевірки автентифікації:",e.message,e.stack),null}}function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return(e||window.location.pathname).startsWith("/next_myfin")?"/next_myfin/":"/"}function i(){a.A.remove("supabase-auth-token",{path:"/"})}async function o(e,t){let r={data:null,error:""};try{if(!await l())return r.error="Користувач не авторизований",r;let{data:a,error:s}=await n.DB.from(n.Bt.main).select("*").gte("created_at",e).lte("created_at",t);if(s)return r.error="Помилка отримання даних із ".concat(n.Bt.main,": ")+s.message,r;r.data=a}catch(e){r.error="Виняток у getStatistic: "+e.message}return r}async function d(e,t,r,a,c){try{if(!await l())throw"Користувач не авторизований";let i=JSON.parse(s()),o={sum:t,type:r,user_id:i.user.id,created_at:new Date(e),category:a||null,comment:c||null},{error:d}=await n.DB.from(n.Bt.main).insert([o]);if(d)throw d;return await m(t,r),!0}catch(e){return console.error("Помилка запиту:",e.message),!1}}async function u(e,t){try{if(!await l())throw"Користувач не авторизований";let r=JSON.parse(s()),a={sum:t,user_id:r.user.id},{error:c}=await n.DB.from(n.Bt.main).update(a).eq("id",e);if(c)throw c;return!0}catch(e){return console.error("Помилка запиту:",e.message),!1}}async function m(e,t){let r=await f(),a=0;r.data.id>0&&(a="expense"===t?r.data.uah-Number(e):r.data.uah+Number(e),await h(r.data.id,a))}async function h(e,t){try{if(!await l())throw"Користувач не авторизований";let r=JSON.parse(s()),a={uah:t,user_id:r.user.id,last_check:new Date},{error:c}=await n.DB.from(n.Bt.balance).update(a).eq("id",e);if(c)throw c;return!0}catch(e){return console.error("Помилка запиту:",e.message),!1}}async function f(){let e={data:null,error:""};try{if(!await l())return e.error="Користувач не авторизований",e;let t=JSON.parse(s()),{data:r,error:a}=await n.DB.from(n.Bt.balance).select("*").eq("user_id",t.user.id).single();if(a)return e.error="Помилка отримання даних із ".concat(n.Bt.balance,": ")+a.message,e;e.data=r}catch(t){e.error="Виняток у getBalance: "+t.message}return e}async function x(e){try{if(!await l())throw Error("Користувач не авторизований");let t=JSON.parse(s()),{error:r}=await n.DB.from(n.Bt.main).delete().eq("id",e).eq("user_id",t.user.id);if(r)return!1;return!0}catch(e){return!1}}r(87)},5576:(e,t,r)=>{"use strict";r.d(t,{Bt:()=>n,DB:()=>a,L1:()=>s});let a=(0,r(2659).UU)("https://vntunuzrneoakdckqjvk.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZudHVudXpybmVvYWtkY2txanZrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE3MTI5NzEsImV4cCI6MjA2NzI4ODk3MX0.CWJIVqq-x5_doDk8rsl8ZJWP7um9VakuIDBihcfsrsU"),n={main:"fin_statistic",balance:"fin_balance"},s={pr:"Продукти",cf:"Кафе",cm:"Кумунальні платежі",md:"Аптека",eva:"Eva/Makeup",zoo:"Зоотовари",cl:"Одяг",usd:"Валюта",ot:"Інше"}},8148:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var a=r(5155),n=r(2619),s=r.n(n);function l(e){let{href:t,text:r,color:n}=e;return(0,a.jsx)("div",{className:"text-center p-2",children:(0,a.jsx)(s(),{href:t,className:"btn btn-".concat(n," btn-menu fs-4 fw-bold"),children:r})})}},9270:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>D});var a=r(5155),n=r(8148),s=r(4964),l=r(2115),c=r(2253),i=r(4091),o=r(9582),d=r(907);function u(e){let{data:t}=e,r=(0,s.pt)(),[n,c]=(0,l.useState)(!1),[i,o]=(0,l.useState)(t),u=(0,l.useRef)([]);if((0,l.useEffect)(()=>{n&&o(t.map(e=>({...e})))},[n,t]),(0,l.useEffect)(()=>{n&&t.length>0&&(u.current=JSON.parse(JSON.stringify(t)),o(t.map(e=>({...e}))))},[n,t]),(0,l.useEffect)(()=>{t=n?i:t},[n,i,t]),!(t.length>0))return(0,a.jsx)("div",{className:"alert alert-info",role:"alert",children:"Дані відсутні"});{let e=(0,d.w8)(t);return(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"alert alert-success",role:"alert",children:["Дохід ",(0,a.jsx)("i",{children:e})," UAH",(0,a.jsx)("img",{src:r+"icons/edit.svg",alt:"Редагувати",width:"24",height:"24",className:"edit-btn",onClick:function(){c(!n)},style:{marginLeft:"8px",verticalAlign:"middle"}}),(0,a.jsx)("button",{className:"m-2 btn btn-success fade ".concat(n?"show":""),onClick:m,disabled:!n,children:"Зберегти"})]}),(0,a.jsxs)("table",{className:"table table-striped",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"Сума"}),(0,a.jsx)("th",{children:"Дата"})]})}),(0,a.jsx)("tbody",{children:i.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"td-w-250 m-2",children:n?(0,a.jsx)("input",{className:"i-w",type:"number",value:e.sum,onChange:t=>(function(e,t){let r=parseFloat(t)||0;o(t=>t.map(t=>t.id===e?{...t,sum:r}:t))})(e.id,t.target.value)}):e.sum}),(0,a.jsx)("td",{children:new Date(e.created_at).toLocaleDateString("uk-UA")})]},e.id))})]})]})}async function m(){if(JSON.stringify(i)===JSON.stringify(u.current))return void c(!1);c(!1);let e=[];if(i.forEach(t=>{let r=u.current.find(e=>e.id===t.id);r&&t.sum!==r.sum&&e.push((0,s.m8)(r.id,t.sum))}),e.length>0)try{await Promise.all(e),u.current=[...i],location.reload()}catch(e){console.error("Помилка під час оновлення даних:",e)}else c(!1)}}var m=r(5576),h=r(134),f=r(1259),x=r(9386),j=r(3420),p=r(46);function g(e){let{active:t,payload:r}=e;if(t&&r&&r.length){let{name:e,value:t,percentage:n}=r[0].payload;return(0,a.jsx)("div",{className:"bg-white p-2 border border-gray-300 rounded shadow",children:(0,a.jsx)("p",{children:"".concat(e,": ").concat(t," (").concat(n,"%)")})})}return null}function v(e){let{data:t}=e,r=["#0088FE","#00C49F","#FFBB28","#0257a5","#41c400","#ff7a28","#9800fe","#c4004b","#ff2828","#00fec3","#a0c400","#35189c"];return(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsxs)(h.r,{width:600,height:400,children:[(0,a.jsx)(f.F,{data:t,cx:"50%",cy:"50%",outerRadius:150,fill:"#8884d8",dataKey:"value",label:e=>{let{name:t,percentage:r}=e;return"".concat(t,": ").concat(r,"%")},children:t.map((e,t)=>(0,a.jsx)(x.f,{fill:r[t%r.length]},"cell-".concat(t)))}),(0,a.jsx)(j.m,{content:(0,a.jsx)(g,{})}),(0,a.jsx)(p.s,{})]})})}function N(e){let{data:t}=e;if(!(t.length>0))return(0,a.jsx)("div",{className:"alert alert-info",role:"alert",children:"Дані відсутні"});{let e=(0,d.zl)(t),r=(0,d.w8)(t),n=(0,d.b8)(e),s=(0,d.nS)(e),l=(0,d.E6)(r,s);return(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"alert alert-danger",role:"alert",children:["Витрати ",(0,a.jsx)("i",{children:r})," UAH"]}),(0,a.jsx)("div",{className:"d-flex justify-content-center",children:(0,a.jsx)(v,{data:l})}),(0,a.jsxs)("table",{className:"table table-striped",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"Категорія"}),(0,a.jsx)("th",{children:"Сума"})]})}),(0,a.jsx)("tbody",{children:(0,a.jsx)(b,{data:n,sortData:e})})]})]})}}function b(e){let{data:t,sortData:r}=e;return t&&"object"==typeof t?(0,a.jsx)(a.Fragment,{children:t.map(e=>(0,a.jsxs)(l.Fragment,{children:[(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:"3",children:(0,a.jsx)("b",{children:new Date(e).toLocaleDateString("uk-UA")})})}),Object.entries(m.L1).map(t=>{let[n]=t;return void 0!==r[e][n]?(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{children:m.L1[n]}),(0,a.jsx)("td",{children:r[e][n]})]},n):""})]},e))}):null}function w(e){let{isOpen:t,onClose:r,selectedDate:n,selectedItems:c}=e,i=(0,s.pt)(),o=(0,l.useRef)(null),[d,u]=(0,l.useState)(!1),[h,f]=(0,l.useState)(!1),[x,j]=(0,l.useState)(!1),[p,g]=(0,l.useState)([]),v=(0,l.useRef)([]);if((0,l.useEffect)(()=>{if(t){let e=setTimeout(()=>{u(!0)},50);return()=>clearTimeout(e)}u(!1)},[t]),(0,l.useEffect)(()=>{if(!d&&t){let e=setTimeout(()=>{r()},500);return()=>clearTimeout(e)}},[d,t,r]),(0,l.useEffect)(()=>{h&&g(c.map(e=>({...e})))},[h,c]),(0,l.useEffect)(()=>{h&&c.length>0&&(v.current=JSON.parse(JSON.stringify(c)),g(c.map(e=>({...e}))))},[h,c]),!t)return null;return(0,a.jsx)("div",{className:"custom-modal-overlay ".concat(d?"show":""),children:(0,a.jsxs)("div",{className:"custom-modal",ref:o,children:[(0,a.jsxs)("div",{className:"custom-modal-header",children:[(0,a.jsxs)("h5",{className:"",children:["Деталі витрат за ".concat(n?new Date(n).toLocaleDateString("uk-UA"):""),(0,a.jsx)("img",{src:i+"icons/edit.svg",alt:"Редагувати",width:"24",height:"24",className:"edit-btn",onClick:function(){f(!h),x&&location.reload()},style:{marginLeft:"8px",verticalAlign:"middle"}})]}),(0,a.jsx)("button",{className:"custom-modal-close-btn","aria-label":"Close",onClick:function(){u(!1),f(!1),x&&location.reload()},children:(0,a.jsx)("svg",{width:"24",height:"24",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsx)("div",{className:"custom-modal-body",children:n&&c.length>0?(0,a.jsx)("ul",{children:(h?p:c).map(e=>(0,a.jsxs)("li",{children:[h?(0,a.jsx)("input",{className:"i-w",type:"number",value:e.sum,onChange:t=>(function(e,t){let r=parseFloat(t)||0;g(t=>t.map(t=>t.id===e?{...t,sum:r}:t))})(e.id,t.target.value)}):e.sum," UAH - ",m.L1[e.category],e.comment&&(0,a.jsx)("span",{children:" ("+e.comment+")"}),h&&(0,a.jsx)("img",{src:i+"icons/delete.svg",alt:"Видалити",width:"24",height:"24",className:"delete-btn",onClick:()=>{var t;return t=e.id,void(0,s.Wv)(t).then(()=>{g(e=>e.filter(e=>e.id!==t)),j(!0)})},style:{marginLeft:"8px",verticalAlign:"middle",cursor:"pointer"}})]},e.id))}):(0,a.jsx)("p",{children:"Немає витрат за цей день."})}),(0,a.jsx)("div",{className:"custom-modal-footer",children:(0,a.jsx)("button",{className:"btn btn-success fade ".concat(h?"show":""),onClick:N,disabled:!h,children:"Зберегти"})})]})});async function N(){if(!h)return void u(!1);if(JSON.stringify(p)===JSON.stringify(v.current)){f(!1),u(!1);return}f(!1);let e=[];if(p.forEach(t=>{let r=v.current.find(e=>e.id===t.id);r&&t.sum!==r.sum&&e.push((0,s.m8)(r.id,t.sum))}),e.length>0)try{await Promise.all(e),v.current=[...p],location.reload()}catch(e){console.error("Помилка під час оновлення даних:",e)}else x?location.reload():(f(!1),u(!1))}}function y(e){let{data:t,dateStart:r,dateEnd:n}=e,s=(0,d.zl)(t),c=(0,d.w8)(t),i=(0,d.ac)(r,n),o=(0,d.nS)(s),u=(0,d.E6)(c,o),[m,h]=(0,l.useState)(!1),[f,x]=(0,l.useState)(null),[j,p]=(0,l.useState)({}),g=(0,l.useRef)(null),N=new Date,b=N.toISOString().split("T")[0],y=N.getDate(),D=b;if(y>10){let e=new Date(N);e.setDate(e.getDate()-8),D=e.toISOString().split("T")[0]}let O=i.findIndex(e=>e===D);(0,l.useEffect)(()=>{if(g.current&&-1!==O){let e=g.current,t=e.children[O];t&&(e.scrollLeft=t.offsetLeft)}},[O]);let _=e=>{let r=(0,d.cI)(t,e);x(e),p(r||[]),h(!0)};return(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"alert alert-danger",role:"alert",children:["Витрати ",(0,a.jsx)("i",{children:c})," UAH"]}),(0,a.jsxs)("div",{className:"d-flex mt-5",children:[(0,a.jsx)(k,{}),(0,a.jsx)("div",{ref:g,className:"d-flex scrollable-table",children:i.map(e=>(0,a.jsx)(S,{date:e,items:s[e]||{},openDetail:_},e))})]}),(0,a.jsx)("div",{className:"d-flex justify-content-center",children:(0,a.jsx)(v,{data:u})}),(0,a.jsx)(w,{isOpen:m,onClose:()=>h(!1),selectedDate:f,selectedItems:j})]})}function S(e){let{date:t,items:r,openDetail:n}=e,s=0;return(0,a.jsxs)("div",{className:"colum-expense",children:[(0,a.jsx)("div",{className:"m-1 colum-date",onClick:()=>n(t),children:new Date(t).toLocaleDateString("uk-UA")}),(0,a.jsx)("div",{children:Object.entries(m.L1).map(e=>{let[l]=e,c=r[l]?Number(r[l]):0,i="v-normal";return c>0&&(s+=c),0===c?i="v-gold":c>4e3&&(i="v-many"),(0,a.jsx)("div",{className:i+" v-border",children:c?(0,a.jsx)("span",{className:"value",onClick:()=>n(t),children:c}):(0,a.jsx)("span",{className:"zero-value"})},l)})}),(0,a.jsx)("div",{className:"",children:s?(0,a.jsx)("span",{className:"value",children:(0,a.jsx)("b",{children:s})}):(0,a.jsx)("span",{className:"zero-value"})})]})}function k(){return(0,a.jsxs)("div",{className:"category-column",children:[(0,a.jsx)("div",{className:"m-1",children:"Категорія/Дата"}),Object.entries(m.L1).map(e=>{let[t,r]=e;return(0,a.jsx)("div",{className:"v-light v-border",children:r},t)}),(0,a.jsx)("div",{className:"",children:"За день"})]})}function D(){let[e,t]=(0,l.useState)({income:[],expense:[]}),[r,d]=(0,l.useState)(!0),[m,h]=(0,l.useState)(null),[f,x]=(0,l.useState)(c.Fr?(0,o._B)():(0,o.Ew)()),j=async(e,r)=>{try{d(!0),h(null);let a=await (0,s.h5)(e,r);if(a.error)h(a.error),t({income:[],expense:[]});else{let e={income:[],expense:[]};(a.data||[]).forEach(t=>{"expense"===t.type?e.expense.push(t):"income"===t.type&&e.income.push(t)}),t(e)}d(!1)}catch(e){h("Помилка завантаження даних"),t({income:[],expense:[]}),d(!1),(0,s.e4)(),location.replace("/")}};return(0,l.useEffect)(()=>{j(f.from,f.to)},[]),(0,a.jsxs)("div",{className:"container mt-5",children:[(0,a.jsx)("div",{className:"",children:(0,a.jsx)(n.A,{href:"/",color:"secondary",text:"На головну"})}),(0,a.jsxs)("div",{className:"row mt-3 mb-3",children:[(0,a.jsx)("div",{className:"col-4",children:(0,a.jsx)("input",{type:"date",className:"form-control",value:f.from,"data-date-from":"",onChange:e=>x({...f,from:e.target.value})})}),(0,a.jsx)("div",{className:"col-4",children:(0,a.jsx)("input",{type:"date",className:"form-control","data-date-to":"",value:f.to,onChange:e=>x({...f,to:e.target.value})})}),(0,a.jsx)("div",{className:"col-4",children:(0,a.jsx)("button",{type:"button",className:"btn btn-success",onClick:()=>{let e=document.querySelector("input[data-date-from]").value,t=document.querySelector("input[data-date-to]").value;e&&t?(x({from:e,to:t}),j(e,t)):h("Будь ласка, виберіть обидві дати")},children:"Відобразити"})})]}),(0,a.jsx)("div",{children:m?(0,a.jsx)("div",{className:"alert alert-danger",role:"alert",children:m}):r?(0,a.jsx)(i.A,{header:!1}):(0,a.jsxs)("div",{children:[(0,a.jsx)(u,{data:e.income}),c.Fr?(0,a.jsx)(N,{data:e.expense}):(0,a.jsx)(y,{data:e.expense,dateStart:f.from,dateEnd:f.to})]})})]})}r(433)},9582:(e,t,r)=>{"use strict";function a(){let e=new Date,t=new Date(e);return t.setDate(e.getDate()+1),{from:s(e),to:s(t)}}function n(){let e=new Date,t=new Date(e.getFullYear(),e.getMonth(),1),r=new Date(e.getFullYear(),e.getMonth()+1,0);return{from:s(t),to:s(r)}}function s(e){let t=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(r,"-").concat(a)}function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none",r=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0"),s=e.getDay(),l="";return"short"===t?l=["Нд","Пн","Вт","Ср","Чт","Пт","Сб"][s]+", ":"full"===t&&(l=["Неділя","Понеділок","Вівторок","Середа","Четвер","П'ятниця","Субота"][s]+", "),l+"".concat(n,".").concat(a,".").concat(r)}r.d(t,{At:()=>l,Ew:()=>n,_B:()=>a})}},e=>{e.O(0,[594,57,619,253,959,441,255,358],()=>e(e.s=3060)),_N_E=e.O()}]);