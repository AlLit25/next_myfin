(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[507],{3060:(e,t,r)=>{Promise.resolve().then(r.bind(r,5211))},4091:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});var s=r(5155);function a(e){let{header:t=!0}=e;return(0,s.jsxs)("div",{className:"container",children:[t?(0,s.jsx)("div",{className:"m-5 text-center",children:(0,s.jsx)("p",{className:"h1",children:"LiVi Analytics"})}):"",(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"spinner-border text-success",role:"status",children:(0,s.jsx)("span",{className:"visually-hidden"})}),(0,s.jsx)("h3",{children:"Завантаження..."})]})]})}},4964:(e,t,r)=>{"use strict";r.d(t,{T5:()=>n,e4:()=>c,h5:()=>l});var s=r(2378),a=r(5576);async function n(){try{let t,r=function(){let e=s.A.get("supabase-auth-token");return e||null}();try{t=JSON.parse(r)}catch(e){return!1}if(!t.access_token||!t.refresh_token)return!1;let{data:{session:n},error:c}=await a.DB.auth.setSession({access_token:t.access_token,refresh_token:t.refresh_token});if(!c)return n;{var e;let{data:r,error:c}=await a.DB.auth.refreshSession({refresh_token:t.refresh_token});if(c)return!1;return e=n,s.A.set("supabase-auth-token",JSON.stringify(e),{expires:1,path:"/",secure:!0,sameSite:"Strict"}),r.session}}catch(e){return console.error("Помилка перевірки автентифікації:",e.message),!1}}function c(){s.A.remove("supabase-auth-token",{path:"/"})}async function l(e,t){let r={data:null,error:""};try{if(!await n())return r.error="Користувач не авторизований",r;let{data:s,error:c}=await a.DB.from(a.B.main).select("*").gte("created_at",e).lte("created_at",t);if(c)return r.error="Помилка отримання даних із ".concat(table,":"),c.message,r;r.data=s}catch(e){r.error="Виняток у fetchData: "+e.message}return r}},5211:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>m});var s=r(5155),a=r(8148),n=r(4964),c=r(2115),l=r(4091);function i(e){let t=0;return e.map(e=>{t+=e.sum}),t}function d(e){let{data:t}=e;if(!(t.length>0))return(0,s.jsx)("div",{className:"alert alert-info",role:"alert",children:"Дані відсутні"});{let e=i(t);return(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"alert alert-success",role:"alert",children:["Дохід ",(0,s.jsx)("i",{children:e})," UAH"]}),(0,s.jsxs)("table",{className:"table table-striped",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"Сума"}),(0,s.jsx)("th",{children:"Дата"})]})}),(0,s.jsx)("tbody",{children:t.map(e=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:e.sum}),(0,s.jsx)("td",{children:new Date(e.created_at).toLocaleDateString("uk-UA")})]},e.id))})]})]})}}var o=r(5576);function h(e){let{data:t}=e;if(!(t.length>0))return(0,s.jsx)("div",{className:"alert alert-info",role:"alert",children:"Дані відсутні"});{let e,r=i(t),a=(e={},t.map(t=>{void 0===e[t.created_at]&&(e[t.created_at]=[]),e[t.created_at].push(t)}),e);return(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"alert alert-danger",role:"alert",children:["Витрати ",(0,s.jsx)("i",{children:r})," UAH"]}),(0,s.jsxs)("table",{className:"table table-striped",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"Категорія"}),(0,s.jsx)("th",{children:"Сума"}),(0,s.jsx)("th",{children:"Коментар"})]})}),(0,s.jsx)("tbody",{children:(0,s.jsx)(u,{data:a})})]})]})}}function u(e){let{data:t}=e;return t&&"object"==typeof t?(0,s.jsx)(s.Fragment,{children:Object.keys(t).map(e=>(0,s.jsxs)(c.Fragment,{children:[(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:"3",children:(0,s.jsx)("b",{children:new Date(e).toLocaleDateString("uk-UA")})})}),t[e].map(e=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:o.L[e.category]}),(0,s.jsx)("td",{children:e.sum}),(0,s.jsx)("td",{children:e.comment})]},e.id))]},e))}):null}function m(){let[e,t]=(0,c.useState)({income:[],expense:[]}),[r,i]=(0,c.useState)(!0),[o,u]=(0,c.useState)(null),[m,x]=(0,c.useState)(function(){let e=new Date,t=new Date(e);t.setDate(e.getDate()+1);let r=e=>{let t=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(r,"-").concat(s)};return{from:r(e),to:r(t)}}()),j=async(e,r)=>{try{i(!0),u(null);let s=await (0,n.h5)(e,r);if(s.error)u(s.error),t({income:[],expense:[]});else{let e={income:[],expense:[]};(s.data||[]).forEach(t=>{"expense"===t.type?e.expense.push(t):"income"===t.type&&e.income.push(t)}),t(e)}i(!1)}catch(e){u("Помилка завантаження даних"),t({income:[],expense:[]}),i(!1),(0,n.e4)(),location.replace("/")}};return(0,c.useEffect)(()=>{j(m.from,m.to)},[]),(0,s.jsxs)("div",{className:"container mt-5",children:[(0,s.jsx)("div",{className:"text-center",children:(0,s.jsx)("h1",{children:"Статистика"})}),(0,s.jsx)("div",{className:"d-block mb-3",children:(0,s.jsx)(a.A,{href:"/",color:"secondary",text:"На головну"})}),(0,s.jsxs)("div",{className:"row mt-3 mb-3",children:[(0,s.jsx)("div",{className:"col-4",children:(0,s.jsx)("input",{type:"date",className:"form-control",value:m.from,"data-date-from":!0,onChange:e=>x({...m,from:e.target.value})})}),(0,s.jsx)("div",{className:"col-4",children:(0,s.jsx)("input",{type:"date",className:"form-control","data-date-to":!0,value:m.to,onChange:e=>x({...m,to:e.target.value})})}),(0,s.jsx)("div",{className:"col-4",children:(0,s.jsx)("button",{type:"button",className:"btn btn-success",onClick:()=>{let e=document.querySelector("input[data-date-from]").value,t=document.querySelector("input[data-date-to]").value;e&&t?(x({from:e,to:t}),j(e,t)):u("Будь ласка, виберіть обидві дати")},children:"Відобразити"})})]}),(0,s.jsx)("div",{children:o?(0,s.jsx)("div",{className:"alert alert-danger",role:"alert",children:o}):r?(0,s.jsx)(l.A,{header:!1}):(0,s.jsxs)("div",{children:[(0,s.jsx)(d,{data:e.income}),(0,s.jsx)(h,{data:e.expense})]})})]})}},5576:(e,t,r)=>{"use strict";r.d(t,{B:()=>a,DB:()=>s,L:()=>n});let s=(0,r(2659).UU)("https://vntunuzrneoakdckqjvk.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZudHVudXpybmVvYWtkY2txanZrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE3MTI5NzEsImV4cCI6MjA2NzI4ODk3MX0.CWJIVqq-x5_doDk8rsl8ZJWP7um9VakuIDBihcfsrsU"),a={main:"fin_statistic",balance:"fin_balance"},n={pr:"Продукти",cf:"Кафе",cm:"Кумунальні платежі",md:"Аптека",eva:"Eva/Makeup",zoo:"Зоотовари",cl:"Одяг",usd:"Валюта",ot:"Інше"}},8148:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var s=r(5155),a=r(2619),n=r.n(a);function c(e){let{href:t,text:r,color:a}=e;return(0,s.jsx)("div",{className:"text-center p-2",children:(0,s.jsx)(n(),{href:t,className:"btn btn-".concat(a," btn-menu fs-4 fw-bold"),children:r})})}}},e=>{e.O(0,[619,263,441,255,358],()=>e(e.s=3060)),_N_E=e.O()}]);