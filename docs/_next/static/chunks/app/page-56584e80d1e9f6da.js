(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{2093:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>h});var a=r(5155),s=r(2115),n=r(4964),i=r(7260),c=r(5576),l=r(2378);function o(){let[e,t]=(0,s.useState)(""),[r,n]=(0,s.useState)(""),[o,u]=(0,s.useState)(null);(0,i.useRouter)();let d=async t=>{t.preventDefault(),u(null);try{let{data:t,error:a}=await c.DB.auth.signInWithPassword({email:e,password:r});if(a)return void u(a.message);l.A.set("supabase-auth-token",JSON.stringify(t.session),{expires:1,path:"/",secure:!0,sameSite:"Strict"}),location.reload()}catch(e){u("Помилка авторизації: "+e.message)}};return(0,a.jsx)("div",{className:"d-block",children:(0,a.jsxs)("form",{onSubmit:d,children:[o&&(0,a.jsx)("div",{className:"alert alert-danger",children:o}),(0,a.jsx)("div",{className:"d-flex justify-content-center m-4",children:(0,a.jsxs)("div",{className:"w-50",children:[(0,a.jsx)("label",{className:"form-label",children:"Email"}),(0,a.jsx)("input",{className:"form-control form-control-lg",type:"email",placeholder:"email@com.ua",value:e,onChange:e=>t(e.target.value),required:!0})]})}),(0,a.jsx)("div",{className:"d-flex justify-content-center m-4",children:(0,a.jsxs)("div",{className:"w-50",children:[(0,a.jsx)("label",{className:"form-label",children:"Пароль"}),(0,a.jsx)("input",{className:"form-control form-control-lg",type:"password",placeholder:"",value:r,onChange:e=>n(e.target.value),required:!0})]})}),(0,a.jsx)("div",{className:"d-flex justify-content-center m-4",children:(0,a.jsx)("button",{type:"submit",className:"btn btn-primary",children:"Увійти"})})]})})}var u=r(8148);function d(){return(0,a.jsxs)("div",{className:"d-block",children:[(0,a.jsx)(u.A,{href:"/income",color:"primary",text:"Дохід"}),(0,a.jsx)(u.A,{href:"/expense",color:"primary",text:"Витрати"}),(0,a.jsx)(u.A,{href:"/statistic",color:"primary",text:"Звіт"}),(0,a.jsx)(u.A,{href:"/balance",color:"primary",text:"Баланс"}),(0,a.jsx)(u.A,{href:"/main",color:"secondary",text:"(dev)"}),(0,a.jsx)("div",{children:(0,a.jsx)("ul",{children:(0,a.jsx)("li",{children:"Відображення головної інформації на головному екрані"})})})]})}var m=r(4091);function h(){let[e,t]=(0,s.useState)(!1),[r,i]=(0,s.useState)(!0);return((0,s.useEffect)(()=>{!async function(){try{await (0,n.T5)()?t(!0):((0,n.e4)(),t(!1)),i(!1)}catch(e){(0,n.e4)(),t(!1),i(!1)}}()},[]),r)?(0,a.jsx)(m.A,{}):(0,a.jsxs)("div",{className:"container",children:[(0,a.jsx)("div",{className:"m-5 text-center",children:(0,a.jsx)("p",{className:"h1",children:"LiVi Analytics"})}),e?(0,a.jsx)(d,{}):(0,a.jsx)(o,{})]})}},2979:(e,t,r)=>{Promise.resolve().then(r.bind(r,2093))},4091:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var a=r(5155);function s(e){let{header:t=!0}=e;return(0,a.jsxs)("div",{className:"container",children:[t?(0,a.jsx)("div",{className:"m-5 text-center",children:(0,a.jsx)("p",{className:"h1",children:"LiVi Analytics"})}):"",(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"spinner-border text-success",role:"status",children:(0,a.jsx)("span",{className:"visually-hidden"})}),(0,a.jsx)("h3",{children:"Завантаження..."})]})]})}},4964:(e,t,r)=>{"use strict";r.d(t,{Ou:()=>u,T5:()=>i,e4:()=>l,h5:()=>o,m8:()=>d,r1:()=>f,uo:()=>h});var a=r(2378),s=r(5576);function n(){let e=a.A.get("supabase-auth-token");return e||null}async function i(){try{let t,r=n();try{if(t=JSON.parse(r),null!==t){t.access_token&&t.refresh_token||c();let{data:{session:r},error:n}=await s.DB.auth.setSession({access_token:t.access_token,refresh_token:t.refresh_token});if(!n)return r;{var e;let{data:n,error:i}=await s.DB.auth.refreshSession({refresh_token:t.refresh_token});return i?c():(e=r,a.A.set("supabase-auth-token",JSON.stringify(e),{expires:1,path:"/",secure:!0,sameSite:"Strict"})),n.session}}c()}catch(e){c()}}catch(e){console.error("Помилка перевірки автентифікації:",e.message,e.line),c()}}function c(){let e,t=location.pathname;console.log(t),e=t.startsWith("/next_myfin")?"/next_myfin/":"/",t!==e&&(location.href=e)}function l(){a.A.remove("supabase-auth-token",{path:"/"})}async function o(e,t){let r={data:null,error:""};try{if(!await i())return r.error="Користувач не авторизований",r;let{data:a,error:n}=await s.DB.from(s.B.main).select("*").gte("created_at",e).lte("created_at",t);if(n)return r.error="Помилка отримання даних із ".concat(s.B.main,": ")+n.message,r;r.data=a}catch(e){r.error="Виняток у getStatistic: "+e.message}return r}async function u(e,t,r,a,c){try{if(!await i())throw"Користувач не авторизований";let l=JSON.parse(n()),o={sum:t,type:r,user_id:l.user.id,created_at:new Date(e),category:a||null,comment:c||null},{error:u}=await s.DB.from(s.B.main).insert([o]);if(u)throw u;return await m(t,r),!0}catch(e){return console.error("Помилка запиту:",e.message),!1}}async function d(e,t){try{if(!await i())throw"Користувач не авторизований";let r=JSON.parse(n()),a={sum:t,user_id:r.user.id},{error:c}=await s.DB.from(s.B.main).update(a).eq("id",e);if(c)throw c;return!0}catch(e){return console.error("Помилка запиту:",e.message),!1}}async function m(e,t){let r=await f(),a=0;r.data.id>0&&(a="expense"===t?r.data.uah-Number(e):r.data.uah+Number(e),await h(r.data.id,a))}async function h(e,t){try{if(!await i())throw"Користувач не авторизований";let r=JSON.parse(n()),a={uah:t,user_id:r.user.id,last_check:new Date},{error:c}=await s.DB.from(s.B.balance).update(a).eq("id",e);if(c)throw c;return!0}catch(e){return console.error("Помилка запиту:",e.message),!1}}async function f(){let e={data:null,error:""};try{if(!await i())return e.error="Користувач не авторизований",e;let t=JSON.parse(n()),{data:r,error:a}=await s.DB.from(s.B.balance).select("*").eq("user_id",t.user.id).single();if(a)return e.error="Помилка отримання даних із ".concat(s.B.balance,": ")+a.message,e;e.data=r}catch(t){e.error="Виняток у getBalance: "+t.message}return e}},5576:(e,t,r)=>{"use strict";r.d(t,{B:()=>s,DB:()=>a,L:()=>n});let a=(0,r(2659).UU)("https://vntunuzrneoakdckqjvk.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZudHVudXpybmVvYWtkY2txanZrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE3MTI5NzEsImV4cCI6MjA2NzI4ODk3MX0.CWJIVqq-x5_doDk8rsl8ZJWP7um9VakuIDBihcfsrsU"),s={main:"fin_statistic",balance:"fin_balance"},n={pr:"Продукти",cf:"Кафе",cm:"Кумунальні платежі",md:"Аптека",eva:"Eva/Makeup",zoo:"Зоотовари",cl:"Одяг",usd:"Валюта",ot:"Інше"}},8148:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});var a=r(5155),s=r(2619),n=r.n(s);function i(e){let{href:t,text:r,color:s}=e;return(0,a.jsx)("div",{className:"text-center p-2",children:(0,a.jsx)(n(),{href:t,className:"btn btn-".concat(s," btn-menu fs-4 fw-bold"),children:r})})}}},e=>{e.O(0,[619,263,441,255,358],()=>e(e.s=2979)),_N_E=e.O()}]);